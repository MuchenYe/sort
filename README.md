# sort一、系统简介
本系统是一款基于机器视觉与机器人控制的智能物流仓储分拣码垛解决方案，能够实现自动化的物料识别、抓取、分拣与码垛操作。通过摄像头采集图像信息，结合颜色识别与轮廓分析技术，系统可精准定位目标物料，并控制机械臂完成抓取与码垛动作，同时支持机器人小车的自主巡线导航，适用于中小型仓储场景的自动化升级。
二、核心功能
自主巡线导航
基于机器视觉的黑线 / 白线识别（可通过阈值切换），通过多个 ROI（感兴趣区域）实时计算线条中心位置，动态调整小车运动方向。
支持路口检测与转向控制，可根据预设路线完成多节点仓储区域的自主移动。
智能物料识别
支持红、蓝、绿三色物料的实时识别与定位，通过 HSV 颜色空间阈值分割与最大轮廓提取算法，精准获取物料中心坐标。
具备抗干扰能力，可过滤小面积噪点，确保识别稳定性。
机械臂分拣码垛
基于逆运动学算法，实现机械臂的精准定位与运动控制，支持物料的抓取、移动、放置全流程自动化。
支持多位置码垛，可根据物料数量自动调整放置位置，实现有序堆叠。
串口通信与控制
通过串口与机器人小车、机械臂进行实时通信，发送运动控制指令，支持速度与角度参数的动态调整。
三、技术架构
1. 硬件依赖
摄像头（支持 USB 接口，分辨率不低于 160×120）
机器人小车（含 4 个驱动轮及电机控制模块）
多自由度机械臂（含舵机驱动系统）
串口通信模块（如 USB 转 TTL 模块）
2. 软件环境
操作系统：Linux（推荐 Ubuntu 20.04 及以上）
Python 版本：3.10 及以上
依赖库：
bash
pip install opencv-python numpy pyserial apriltag

3. 核心模块
模块名称	功能描述
LineSortMap2	实现巡线导航逻辑，包括线条识别、路口检测、小车运动控制
Kinematics	机械臂逆运动学计算，将目标坐标转换为舵机控制指令
ColorPalletizer	物料颜色识别与码垛控制，实现抓取、移动、放置的全流程自动化
RobotMoveCmd	机器人小车运动控制，通过串口发送速度指令
handle_uart_command	串口命令处理线程，接收外部控制指令并切换系统运行状态
四、使用指南
1. 环境配置
安装依赖库：
bash
pip install -r requirements.txt  # 若未生成requirements.txt，可手动安装上述依赖

连接硬件设备，确保摄像头、串口设备正常识别：
摄像头默认设备号为/dev/video0（可在cv2.VideoCapture(0)中修改）
串口默认端口为/dev/ttyUSB0，波特率 115200（可在serial.Serial中修改）
2. 启动系统
bash
python3 sort.py

系统启动后将自动初始化设备，并进入待机状态，等待串口指令触发对应功能。
3. 功能控制
通过串口发送指令可切换系统运行模式，核心指令如下：

#Map2LineWalk!：启动地图 2 巡线模式
其他模式指令可参考代码中handle_uart_command函数的注释说明
4. 参数调整
巡线参数：在LineSortMap2类中修改GRAYSCALE_THRESHOLD（线条颜色阈值）和ROIS（采样区域）
颜色识别参数：在对应类中调整red_threshold、blue_threshold等 HSV 阈值
机械臂偏移量：在run方法中调整cx、cy、cz参数，优化抓取精度
五、注意事项
硬件连接前需确保电源稳定，机械臂运动范围内无障碍物
首次使用时建议先调试颜色阈值与巡线路径，确保识别准确性
串口通信异常时，可检查设备权限（如添加用户到dialout组）或更换 USB 端口
长时间运行时需注意设备散热，避免因温度过高导致性能下降
六、扩展建议
可增加二维码（AprilTag）识别功能，实现物料信息的精准追溯
优化机械臂运动轨迹算法，提高码垛效率
增加多机协同控制逻辑，适用于更大规模的仓储场景
